<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <artifactId>pinbaladmin-ear</artifactId>
    <packaging>ear</packaging>

    <parent>
        <groupId>org.fundaciobit.pinbaladmin</groupId>
        <artifactId>pinbaladmin</artifactId>
        <version>2.0.0</version>
    </parent>

    <name>PinbalAdmin - Ear</name>

    <properties>
        <!-- Format del timestamp -->
        <maven.build.timestamp.format>dd/MM/yyyy HH:mm</maven.build.timestamp.format>
    </properties>

    <dependencies>

        <!-- Internes -->

        <dependency>
            <groupId>org.fundaciobit.pinbaladmin</groupId>
            <artifactId>pinbaladmin-persistence</artifactId>
            <version>${project.version}</version>
        </dependency>

        <dependency>
            <groupId>org.fundaciobit.pinbaladmin</groupId>
            <artifactId>pinbaladmin-ejb</artifactId>
            <version>${project.version}</version>
            <exclusions>
                <exclusion>
                    <groupId>commons-io</groupId>
                    <artifactId>commons-io</artifactId>
                </exclusion>
            </exclusions>
            <type>ejb</type>
        </dependency>


        <dependency>
            <groupId>org.fundaciobit.pinbaladmin</groupId>
            <artifactId>pinbaladmin-back</artifactId>
            <version>${project.version}</version>
            <type>war</type>
        </dependency>

    		<dependency>
    			<groupId>org.fundaciobit.pinbaladmin</groupId>
    			<artifactId>pinbaladmin-front</artifactId>
    			<version>${project.version}</version>
    			<type>war</type>
    		</dependency>
    		
        <dependency>
            <artifactId>pinbaladmin-ws-domini-sistra-server</artifactId>
            <groupId>org.fundaciobit.pinbaladmin</groupId>
            <version>${project.version}</version>
            <type>ejb</type>
        </dependency>

        <!-- Tenir en compte a l'hora de incloure dependències només si és imprescindible 
			i no està ja dins un mòdul sobre el que es pugui establir una dependència 
			als descriptors. https://docs.jboss.org/author/display/AS72/Implicit+module+dependencies+for+deployments -->
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-api</artifactId>
        </dependency>


        <!-- Externes -->

        <!-- ====================================== -->
        <!-- ===== PLUGINS DE USERINFORMATION ===== -->
        <!-- ====================================== -->
        <dependency>
            <groupId>org.fundaciobit.pluginsib.userinformation</groupId>
            <artifactId>pluginsib-userinformation-keycloak</artifactId>
            <version>${pluginsib.userinformation.api.version}</version>
            <exclusions>
                <exclusion>
                    <groupId>org.fundaciobit.pluginsib.core</groupId>
                    <artifactId>pluginsib-core</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.jboss.resteasy</groupId>
                    <artifactId>resteasy-client</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.jboss.resteasy</groupId>
                    <artifactId>resteasy-multipart-provider</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.jboss.resteasy</groupId>
                    <artifactId>resteasy-jaxrs</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.jboss.resteasy</groupId>
                    <artifactId>resteasy-jaxb-provider</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.jboss.resteasy</groupId>
                    <artifactId>resteasy-jackson2-provider</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>commons-logging</groupId>
                    <artifactId>commons-logging</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>org.fundaciobit.pluginsib.userinformation</groupId>
            <artifactId>pluginsib-userinformation-database</artifactId>
            <version>${pluginsib.userinformation.api.version}</version>
            <exclusions>
                <exclusion>
                    <groupId>org.fundaciobit.pluginsib.core</groupId>
                    <artifactId>pluginsib-core</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>org.fundaciobit.pluginsib.userinformation</groupId>
            <artifactId>pluginsib-userinformation-ldap</artifactId>
            <version>${pluginsib.userinformation.api.version}</version>
            <exclusions>
                <exclusion>
                    <groupId>org.fundaciobit.pluginsib.core</groupId>
                    <artifactId>pluginsib-core</artifactId>
                </exclusion>
            </exclusions>
        </dependency>

        <!-- ============================================ -->
        <!-- ========== PLUGINS DE DATAEXPORT =========== -->
        <!-- ============================================ -->

        <!-- API -->
        <dependency>
            <groupId>org.fundaciobit.pluginsib.exportdata</groupId>
            <artifactId>pluginsib-exportdata-api</artifactId>
            <version>3.0.0-SNAPSHOT</version>
            <exclusions>
                <exclusion>
                    <groupId>org.fundaciobit.pluginsib.core</groupId>
                    <artifactId>pluginsib-core</artifactId>
                </exclusion>
            </exclusions>
        </dependency>


        <!-- Excel Plugin -->
        <dependency>
            <groupId>org.fundaciobit.pluginsib.exportdata</groupId>
            <artifactId>pluginsib-exportdata-excel</artifactId>
            <version>3.0.0-SNAPSHOT</version>
            <exclusions>
                <exclusion>
                    <groupId>org.fundaciobit.pluginsib.core</groupId>
                    <artifactId>pluginsib-core</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.apache.poi</groupId>
                    <artifactId>poi</artifactId>
                </exclusion>
            </exclusions>
        </dependency>

        <!-- ODS Plugin -->
        <dependency>
            <groupId>org.fundaciobit.pluginsib.exportdata</groupId>
            <artifactId>pluginsib-exportdata-ods</artifactId>
            <version>3.0.0-SNAPSHOT</version>
            <exclusions>
                <exclusion>
                    <groupId>org.fundaciobit.pluginsib.core</groupId>
                    <artifactId>pluginsib-core</artifactId>
                </exclusion>
            </exclusions>
        </dependency>

        <!-- CSV Plugin -->
        <dependency>
            <groupId>org.fundaciobit.pluginsib.exportdata</groupId>
            <artifactId>pluginsib-exportdata-csv</artifactId>
            <version>3.0.0-SNAPSHOT</version>
            <exclusions>
                <exclusion>
                    <groupId>org.fundaciobit.pluginsib.core</groupId>
                    <artifactId>pluginsib-core</artifactId>
                </exclusion>
            </exclusions>
        </dependency>

        <!-- Commons Dependencies -->


        <dependency>
            <groupId>commons-fileupload</groupId>
            <artifactId>commons-fileupload</artifactId>
            <version>1.3</version>
            <exclusions>
                <exclusion>
                    <groupId>commons-io</groupId>
                    <artifactId>commons-io</artifactId>
                </exclusion>
            </exclusions>
        </dependency>

        <!--<dependency>
			<groupId>commons-io</groupId>
			<artifactId>commons-io</artifactId>
			<version>2.13.0</version>
		</dependency>-->

        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-lang3</artifactId>
        </dependency>


        <!-- API REST de PinbalAdmin -->

        <!-- API EXTERNA START 
        http://localhost:8080/pinbaladminapi/externa/index.html 
        <dependency>
            <groupId>org.fundaciobit.pinbaladmin</groupId>
            <artifactId>pinbaladmin-api-externa</artifactId>
            <version>2.0.0</version>
            <type>war</type>
        </dependency>
        API EXTERNA END -->

        <!-- API INTERNA START -->
        <!-- http://localhost:8080/pinbaladminapi/interna/index.html -->
        <dependency>
            <groupId>org.fundaciobit.pinbaladmin</groupId>
            <artifactId>pinbaladmin-api-interna</artifactId>
            <version>2.0.0</version>
            <type>war</type>
        </dependency>
        <!-- API INTERNA END -->

    </dependencies>


    <build>
        <finalName>pinbaladmin</finalName>

        <filters>
            <filter>../config.properties</filter>
        </filters>

        <plugins>

            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-ear-plugin</artifactId>

                <!-- configuring the ear plugin -->
                <configuration>

                    <displayName>PinbalAdmin</displayName>
                    <description>PinbalAdmin</description>

                    <generateApplicationXml>true</generateApplicationXml>
                    <defaultLibBundleDir>lib</defaultLibBundleDir>
                    <skinnyWars>true</skinnyWars>
                    <includeLibInApplicationXml>false</includeLibInApplicationXml>
                    <!--suppress UnresolvedMavenProperty -->
                    <!-- Nom mòduls d'acord amb punt 4.2 de l'Estàndard CAIB -->
                    <outputFileNameMapping>@{artifactId}@-@{version}@.@{extension}@</outputFileNameMapping>
                    <version>8</version>

                    <archive>
                        <manifest>
                            <addDefaultImplementationEntries>true</addDefaultImplementationEntries>
                        </manifest>
                        <manifestEntries>
                            <project-version>${project.version}</project-version>
                            <project-buildtime>${maven.build.timestamp}</project-buildtime>
                            <scm-revision>${buildNumber}</scm-revision>
                        </manifestEntries>
                    </archive>

                    <defaultLibBundleDir>lib</defaultLibBundleDir>
                    
                    <packagingExcludes>
                        <!-- Requereix afegir mòdul 'com.sun.xml.bind' a jboss-deployment-structure.xml -->
                         **/jaxb-runtime-*redhat*.jar,
                         **/jaxb-xjc-*redhat*.jar,
                         **/jaxb-jxc-*redhat*.jar,
                         **/codemodel-*redhat*.jar,
                         **/rngom-*redhat*.jar,
                        <!-- Requereix afegir mòdul 'com.sun.xml.txw2' a jboss-deployment-structure.xml -->
                         **/txw2-*redhat*.jar,
                        <!-- Requereix afegir mòdul 'org.apache.commons.codec' a jboss-deployment-structure.xml -->
                         **/commons-codec-*redhat*.jar,
                        <!-- Requereix afegir mòdul 'org.apache.httpcomponents.core' a jboss-deployment-structure.xml -->
                         **/httpclient-*redhat*.jar,
                         **/httpcore-*redhat*.jar,
                        <!-- Requereix afegir mòdul 'javax.annotation.api' a jboss-deployment-structure.xml -->
                         **/jboss-annotations-api_1.3_spec-*redhat*.jar,
                        <!-- Requereix afegir mòdul 'org.jboss.ejb3' a jboss-deployment-structure.xml -->
                         **/jboss-ejb3-ext-api-*redhat*.jar,
                        <!-- Requereix afegir mòdul 'javax.xml.bind.api' a jboss-deployment-structure.xml -->
                         **/jboss-jaxb-api_2.3_spec-*redhat*.jar,
                        <!-- Requereix afegir mòdul 'org.codehaus.jettison' a jboss-deployment-structure.xml -->
                         **/jettison-*redhat*.jar,
                        <!-- Requereix afegir mòdul 'org.apache.commons.io' a jboss-deployment-structure.xml -->
                         **/commons-io-*redhat*.jar,
                        <!-- Requereix afegir mòdul 'org.apache.velocity' a jboss-deployment-structure.xml -->
                         **/velocity-engine-core-*redhat*.jar,
                        <!-- Requereix afegir mòdul 'com.sun.xml.fastinfoset' a jboss-deployment-structure.xml -->
                         **/FastInfoset-*redhat*.jar,
                        <!-- Requereix afegir mòdul 'org.bouncycastle' a jboss-deployment-structure.xml -->
                         **/bcprov-jdk15on-*redhat*.jar,
                         **/bcmail-jdk15on-*redhat*.jar,
                         **/bcpkix-jdk15on-*redhat*.jar,
                        <!-- Requereix afegir mòdul 'org.apache.commons.lang3' a jboss-deployment-structure.xml -->
                         **/commons-lang3-*redhat*.jar,
                        <!-- Requereix afegir mòdul 'com.google.code.gson' a jboss-deployment-structure.xml -->
                         **/gson-*redhat*.jar,
                         <!-- Requereix afegir mòdul 'javax.activation.api' a jboss-deployment-structure.xml -->
                         **/activation-*redhat*.jar,
                         
                        <!-- **/jackson-*.redhat*.jar requreix entrades a jboss-deployment-structure.xml -->
                        **/jackson-jaxrs-*.redhat*.jar,
                        **/jackson-core-asl-*.redhat*.jar,
                        **/jackson-xc-*.redhat*.jar,
                        **/jackson-mapper-asl-*.redhat*.jar,
                        
                        <!-- Requereix afegir mòdul 'com.sun.istack' a jboss-deployment-structure.xml -->
                        **/istack-commons-runtime-*.redhat*.jar,
                        
                        
                        <!-- Requereix afegir mòdul 'com.fasterxml.jackson.datatype.jackson-datatype-jsr310' a jboss-deployment-structure.xml -->
                         **/jackson-datatype-jsr310*redhat*.jar,
                        <!-- Requereix afegir mòdul 'org.jboss.logging.commons.logging' a jboss-deployment-structure.xml -->
                         **/commons-logging-jboss-logging*redhat*.jar,
                        
                        <!-- Requereix afegir mòdul 'org.slf4j' a jboss-deployment-structure.xml-->
                         **/slf4j-api*redhat*.jar,
                        
                         <!-- Requereix afegir mòdul 'javax.mail.api' a jboss-deployment-structure.xml -->
                         **/javax.mail*redhat*.jar,
                        
                    </packagingExcludes>

                    <modules>

                        <webModule>
                            <groupId>org.fundaciobit.pinbaladmin</groupId>
                            <artifactId>pinbaladmin-back</artifactId>
                            <contextRoot>pinbaladmin</contextRoot>
                            <bundleFileName>pinbaladmin-back.war</bundleFileName>
                        </webModule>

                        
						<webModule>
							<groupId>org.fundaciobit.pinbaladmin</groupId>
							<artifactId>pinbaladmin-front</artifactId>
							<contextRoot>pinbaladminfront</contextRoot>
                            <bundleFileName>pinbaladmin-front.war</bundleFileName>
						</webModule>
                        <ejbModule>
                            <groupId>org.fundaciobit.pinbaladmin</groupId>
                            <artifactId>pinbaladmin-ws-domini-sistra-server</artifactId>
                            <bundleFileName>pinbaladmin-ws-domini-sistra-server.jar</bundleFileName>
                        </ejbModule>

                        <!-- API EXTERNA START
                        <webModule>
                            <groupId>org.fundaciobit.pinbaladmin</groupId>
                            <artifactId>pinbaladmin-api-externa</artifactId>
                            <contextRoot>/pinbaladminapi/externa</contextRoot>
                            <bundleFileName>pinbaladmin-api-externa.war</bundleFileName>
                        </webModule>
                         API EXTERNA END -->

                        <!-- API INTERNA START -->
                        <webModule>
                            <groupId>org.fundaciobit.pinbaladmin</groupId>
                            <artifactId>pinbaladmin-api-interna</artifactId>
                            <contextRoot>/pinbaladminapi/interna</contextRoot>
                            <bundleFileName>pinbaladmin-api-interna.war</bundleFileName>
                        </webModule>
                        <!-- API INTERNA END -->
                    </modules>

                </configuration>
            </plugin>

        </plugins>
    </build>


    <profiles>
        <!-- Garantir que es fixa la variable d'entorn JBOSS_HOME -->
        <profile>
            <id>fix JBOSS_HOME</id>
            <activation>
                <property>
                    <name>!env.JBOSS_HOME</name>
                </property>
            </activation>
            <properties>
                <env.JBOSS_HOME>HA DE FIXAR LA VARIABLE D'ENTORN JBOSS_HOME</env.JBOSS_HOME>
            </properties>
        </profile>
        <profile>
            <id>revisionnumber</id>
            <build>
                <plugins>
                    <!-- Defineix la propietat ${buildNumber} que s'empra al filtrat -->
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>buildnumber-maven-plugin</artifactId>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>

</project>
